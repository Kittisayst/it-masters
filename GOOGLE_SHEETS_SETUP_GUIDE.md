# üìã Google Sheets Setup Guide

## Required Sheets Structure

Your Google Spreadsheet must have the following sheets with exact column headers:

---

## 1. **Users Sheet**

**Required columns (in any order):**
- `id` - Unique identifier (auto-generated)
- `username` - Login username
- `password` - Hashed password (auto-generated by library)
- `salt` - Password salt (auto-generated by library)
- `fullName` - Full name of user
- `email` - Email address
- `role` - User role: `admin`, `technician`, or `user`
- `department` - Department name
- `status` - Account status: `active` or `inactive`
- `createdAt` - Creation timestamp (auto-generated)
- `lastLogin` - Last login timestamp (optional)

**Example Headers Row:**
```
id | username | password | salt | fullName | email | role | department | status | createdAt | lastLogin
```

**Important Notes:**
- The first row MUST be the headers
- Column names are case-sensitive
- `password` and `salt` columns are required for authentication
- Don't manually fill password/salt - use the register function

---

## 2. **RepairTasks Sheet**

**Required columns:**
- `id` - Unique identifier
- `date` - Task date
- `reportDate` - Date reported
- `equipment` - Equipment name
- `issue` - Issue description
- `solution` - Solution/fix applied
- `technician` - Assigned technician
- `reporter` - Person who reported
- `status` - Status: `pending`, `in-progress`, `completed`, `cancelled`
- `priority` - Priority: `low`, `medium`, `high`
- `notes` - Additional notes (optional)

**Example Headers Row:**
```
id | date | reportDate | equipment | issue | solution | technician | reporter | status | priority | notes
```

---

## 3. **WorkTasks Sheet**

**Required columns:**
- `id` - Unique identifier
- `date` - Task creation date
- `title` - Task title
- `description` - Task description
- `assignedTo` - Person assigned
- `status` - Status: `todo`, `in-progress`, `done`
- `priority` - Priority: `low`, `medium`, `high`
- `dueDate` - Due date
- `notes` - Additional notes (optional)

**Example Headers Row:**
```
id | date | title | description | assignedTo | status | priority | dueDate | notes
```

---

## üöÄ Quick Setup Steps

### Step 1: Create Google Spreadsheet
1. Go to [Google Sheets](https://sheets.google.com)
2. Create a new spreadsheet
3. Name it (e.g., "IT Master System")

### Step 2: Create Sheets
1. Create 3 sheets: `Users`, `RepairTasks`, `WorkTasks`
2. Add the exact header columns shown above to each sheet
3. Leave row 2 onwards empty (data will be added via the app)

### Step 3: Deploy Google Apps Script
1. In your spreadsheet, go to **Extensions > Apps Script**
2. Delete any existing code
3. Copy the Google Apps Script code from the library documentation
4. Click **Deploy > New deployment**
5. Choose **Web app**
6. Set:
   - Execute as: **Me**
   - Who has access: **Anyone** (or your organization)
7. Click **Deploy**
8. Copy the **Web app URL**

### Step 4: Configure Environment Variables
1. Copy `.env.example` to `.env`
2. Set the values:
   ```
   VITE_SPREADSHEET_ID=your_spreadsheet_id_from_url
   VITE_APPS_SCRIPT_URL=your_web_app_url_from_deploy
   ```

**Finding Spreadsheet ID:**
From URL: `https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit`

### Step 5: Create First Admin User
Since you can't login without users, you need to create the first user manually:

**Option A: Use the register endpoint directly**
```javascript
// In browser console or Postman
const response = await fetch('YOUR_APPS_SCRIPT_URL?action=register&skey=YOUR_SPREADSHEET_ID&username=admin&password=admin123&fullName=Administrator&email=admin@example.com&role=admin&department=IT&status=active')
const result = await response.json()
console.log(result)
```

**Option B: Add manually to sheet (NOT RECOMMENDED)**
1. Add a row with basic info
2. Leave `password` and `salt` empty
3. Use the app's register function to create a proper user

---

## ‚úÖ Verification Checklist

- [ ] Users sheet has columns: `username`, `password`, `salt` (minimum required)
- [ ] Users sheet has all recommended columns
- [ ] RepairTasks sheet has all required columns
- [ ] WorkTasks sheet has all required columns
- [ ] Headers are in row 1 (not row 2 or 3)
- [ ] Column names match exactly (case-sensitive)
- [ ] Google Apps Script is deployed as Web App
- [ ] .env file has correct SPREADSHEET_ID and APPS_SCRIPT_URL
- [ ] First admin user is created

---

## üîß Troubleshooting

### Error: "Invalid Users sheet structure"
- Check that Users sheet exists
- Verify columns: `username`, `password`, `salt` are present
- Check spelling and case (must be exact)

### Error: "missing skey parameter"
- Check .env file has VITE_SPREADSHEET_ID
- Restart dev server after changing .env

### Error: "Login failed"
- Verify user exists in Users sheet
- Check password was created via register function
- Ensure status is "active"

### Can't create first user
- Use the register endpoint directly (see Step 5)
- Or temporarily modify the app to allow registration without login

---

## üìù Sample Data

### Users Sheet (after first registration)
```
id          | username | password                                                          | salt                             | fullName       | email              | role  | department | status | createdAt           | lastLogin
1234567890  | admin    | a1b2c3d4e5f6...                                                  | x1y2z3...                        | Administrator  | admin@example.com  | admin | IT         | active | 2024-02-07T08:00:00 | 2024-02-07T08:30:00
```

### RepairTasks Sheet (sample)
```
id          | date       | reportDate | equipment      | issue              | solution           | technician | reporter    | status      | priority | notes
1234567890  | 2024-02-07 | 2024-02-07 | Laptop Dell    | Screen not working | Replaced screen    | ‡∫ä‡ªà‡∫≤‡∫á A     | ‡∫û‡∫∞‡∫ô‡∫±‡∫Å‡∫á‡∫≤‡∫ô B | completed   | high     | Urgent
```

### WorkTasks Sheet (sample)
```
id          | date       | title              | description                  | assignedTo  | status      | priority | dueDate    | notes
1234567890  | 2024-02-07 | Update software    | Update all office computers  | ‡∫û‡∫∞‡∫ô‡∫±‡∫Å‡∫á‡∫≤‡∫ô A | in-progress | medium   | 2024-02-10 | 
```

---

## üéØ Next Steps

After setup:
1. Login with your admin account
2. Create additional users via the Users page
3. Start adding repair tasks and work tasks
4. The system will automatically sync with Google Sheets

For more information, see the [google-sheet-api-client documentation](https://www.npmjs.com/package/google-sheet-api-client).
